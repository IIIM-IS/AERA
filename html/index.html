<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AERA: Installation and usage of Protobuf</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AERA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Installation and usage of Protobuf </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_submodules_AERA_AERA_IODevices_TCP_AERA_Protobuf_README"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation of protobuf and protoc</h1>
<p>Install protobuf using vcpkg. </p>
<h2><a class="anchor" id="autotoc_md2"></a>
Install vcpkg:</h2>
<p>Follow the instructions on the <a href="https://docs.microsoft.com/en-us/cpp/build/install-vcpkg?view=msvc-160&amp;tabs=windows">official Microsoft website</a> to install vcpkg. In short:</p>
<ol type="1">
<li>Clone locally from <a href="https://github.com/Microsoft/vcpkg">https://github.com/Microsoft/vcpkg</a>. It is known to make problems, if there are spaces in the path to vcpkg. So I suggest installing it somewhere like <code>C:\Users\&lt;username&gt;\vcpkg\</code>. So for example: <br  />
 <div class="fragment"><div class="line">C:\Users\Username&gt; git clone https://github.com/Microsoft/vcpkg</div>
</div><!-- fragment --></li>
<li>Change to <code>vcpkg</code> directory: <code>C:\Users\Username&gt; cd vcpkg</code><ol type="a">
<li>In the vcpkg root directory, run the vcpkg bootstrapper command: <code>C:\Users\Username\vcpkg&gt; bootstrap-vcpkg.bat</code></li>
</ol>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md3"></a>
Install protobuf for AERA (NOT Webots) using vcpkg:</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
Prerequisites:</h3>
<p>In order to use protobuf in the debug version of AERA it needs to be compiled with <code>ITERATOR_DEBUG_LEVEL = 0</code>. Do do this you need to change the <code>x86-windows.cmake</code> triplets of vcpkg. <b>Make a backup of the original <code>x86-windows.cmake</code> before continuing</b>. You can find the cmake-files in <code>C:\Users\&lt;username&gt;\vcpkg\triplets</code>. There open the <code>x86-windows.cmake</code> with an editor of choice (e.g. Notepad++) and add the following two lines to the end of the file: </p><div class="fragment"><div class="line">set(VCPKG_C_FLAGS_DEBUG &quot;/D_ITERATOR_DEBUG_LEVEL=0&quot;)</div>
<div class="line">set(VCPKG_CXX_FLAGS_DEBUG &quot;/D_ITERATOR_DEBUG_LEVEL=0&quot;)</div>
</div><!-- fragment --><p>The whole file should look like this: </p><div class="fragment"><div class="line">set(VCPKG_TARGET_ARCHITECTURE x86)</div>
<div class="line">set(VCPKG_CRT_LINKAGE dynamic)</div>
<div class="line">set(VCPKG_LIBRARY_LINKAGE dynamic)</div>
<div class="line">set(VCPKG_C_FLAGS_DEBUG &quot;/D_ITERATOR_DEBUG_LEVEL=0&quot;)</div>
<div class="line">set(VCPKG_CXX_FLAGS_DEBUG &quot;/D_ITERATOR_DEBUG_LEVEL=0&quot;)</div>
</div><!-- fragment --><p>In order to use the installed protobuf version without including further linking the file name should stay the same (x86-windows.cmake).</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Installation:</h3>
<p>Go into the root directory of vcpkg with a terminal and run the following command: </p><div class="fragment"><div class="line">C:\Users&lt;username&gt;\vcpkg&gt; vcpkg install protobuf protobuf:x86-windows</div>
</div><!-- fragment --><p>In order to use protobuf include files in Visual Studio without further linking you should additionally run </p><div class="fragment"><div class="line">C:\Users&lt;username&gt;\vcpkg&gt; vcpkg integrate install</div>
</div><!-- fragment --><p>If it returns with an error message it probably is because of lacking administrator rights. For this open a new terminal as an administrator and rerun the previous command.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Install protobuf for Webots (NOT AERA) using vcpkg:</h2>
<h3><a class="anchor" id="autotoc_md7"></a>
Prerequisites:</h3>
<p>To install Protobuf for usage on the Webots side, there are no prerequisits that you need to take care of. However, Webots is using x64, not x86 architecture. Pay close attention to this.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Installation:</h3>
<p>If the x64 version of protobuf has not been installed automatically when installing the x86 version, all you have to do is follow the same isntructions as above, only changing the install commans to: </p><div class="fragment"><div class="line">C:\Users&lt;username&gt;\vcpkg&gt; vcpkg install protobuf protobuf:x64-windows</div>
</div><!-- fragment --><p>vcpkg should take care of everything else.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Compile proto files:</h1>
<p><b>Not necessary for simply building and using the TCP IODevice, skip if not changing the <code>tcp_data_message.proto</code> file.</b></p>
<p>If you ever change the proto file you will have to recompile it. For this use protoc which is included in the previously installed vcpkg protobuf installation. If protoc is not in your path run the following from the <code>...\vcpkg\installed\x86-windows\tools\protobuf\</code> folder (for the compilation, it does not matter whether you use protoc located in the x86-windows or the x64-windows folder): </p><div class="fragment"><div class="line">protoc -I=C:\Path\to\AERA_Protobuf --cpp_out=C:\Path\to\AERA_Protobuf  C:\Path\to\AERA_Protobuf\tcp_data_message.proto</div>
</div><!-- fragment --><p>If protoc is in your path simply <code>cd</code> into the <code>Proto folder</code> and run: </p><div class="fragment"><div class="line">C:\Path\to\AERA_Protobuf&gt; protoc -I=. --cpp_out=. tcp_data_message.proto</div>
</div><!-- fragment --><p>After recompiling the .proto file you must add the #ifdef ENABLE_PROTOBUF statement to the generated .pp.cc file in the same way as before.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Add created libraries to Webots</h1>
<p>Once everything is installed you need to add the created dlls to your project. For this simply copy-paste <code>libprotobuf.dll</code> and <code>libprotobuf-lite.dll</code> from <code>C:\Path\to\vcpkg\installed\x86-windows\bin</code> to <code>C:\Path\to\Webots\controllers\folder</code>. Now everything should be set up for running AERA with a TCP connection.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Add created libraries to AERA (Should not be necessary)</h1>
<p>Vcpkg should take care of copy pasting the generated dlls to AERA.</p>
<p>However, if this is not the case, do the same as above, copy-pasting the aforementioned dlls to the generated AERA Release folder. Additionally, copy-paste <code>libprotobufd.dll</code> and <code>libprotobuf-lited.dll</code> from <code>C:\Path\to\vcpkg\installed\x86-windows\debug\bin</code> to <code>C:\Path\to\replicode\Debug</code>. Since different dlls are used for Release/ Debug configuration.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Enable protobuf in AERA</h1>
<p>If you want to use the tcp-connection with AERA you have to enable it by setting the ENABLE_PROTOBUF flag in the AERA project properties. For this right-click on the AERA project (in the solution view on the left), select Properties -&gt; C/C++ -&gt; Preprocessor. There in the first line (Preprocessor Definitions) add a new entry called ENABLE_PROTOBUF. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
